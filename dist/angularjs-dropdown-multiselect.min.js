"use strict";var directiveModule=angular.module("angularjs-dropdown-multiselect",[]);function contains(e,t){var n=!1;return e.some(function(e){if(e===t)return n=!0}),n}function find(e,l){var o;return e.some(function(t){var n=!0;if(Object.keys(l).forEach(function(e){t[e]!==l[e]&&(n=!1)}),n)return o=t,!0}),o}function findIndex(e,l){var o=-1,s=-1;return e.some(function(t){var n=!0;if(s+=1,Object.keys(l).forEach(function(e){t[e]!==l[e]&&(n=!1)}),n)return o=s,!0}),o}directiveModule.directive("mfDropdownStaticInclude",["$compile",function(s){return function(e,t,n){var l=n.mfDropdownStaticInclude,o=t.html(l).contents();s(o)(e)}}]),directiveModule.directive("ngDropdownMultiselect",["$filter","$document","$compile","$parse",function(s,t,e,n){return{restrict:"AE",scope:{selectedModel:"=",options:"=",extraSettings:"=",events:"=",searchFilter:"=?",translationTexts:"=",groupBy:"@",disabled:"="},template:function(e,t){var n=!!t.checkboxes,l='<div class="multiselect-parent btn-group dropdown-multiselect" ng-class="{open: open}">';l+='<button ng-disabled="disabled" type="button" class="dropdown-toggle" ng-class="settings.buttonClasses" ng-click="toggleDropdown()">{{getButtonText()}}&nbsp;<span class="caret"></span></button>',l+="<ul class=\"dropdown-menu dropdown-menu-form\" ng-show=\"open\" ng-style=\"{display: open ? 'block' : 'none', height : settings.scrollable ? settings.scrollableHeight : 'auto', overflow: 'auto' }\" >",l+='<li ng-if="settings.showCheckAll && settings.selectionLimit !== 1"><a ng-keydown="keyDownLink($event)" data-ng-click="selectAll()" tabindex="-1" id="selectAll"><span class="glyphicon glyphicon-ok"></span>  {{texts.checkAll}}</a>',l+='<li ng-if="settings.showUncheckAll"><a ng-keydown="keyDownLink($event)" data-ng-click="deselectAll();" tabindex="-1" id="deselectAll"><span class="glyphicon glyphicon-remove"></span>   {{texts.uncheckAll}}</a></li>',l+='<li ng-if="settings.selectByGroups && ((settings.showCheckAll && settings.selectionLimit > 0) || settings.showUncheckAll)" class="divider"></li>',l+='<li ng-if="settings.selectByGroups && ((settings.showCheckAll && settings.selectionLimit > 0) || settings.showUncheckAll)" class="divider"></li>',l+='<li ng-repeat="currentGroup in settings.selectByGroups track by $index" ng-click="selectCurrentGroup(currentGroup)"><a ng-class="{\'dropdown-selected-group\': selectedGroup === currentGroup}" tabindex="-1">{{::texts.selectGroup}} {{::getGroupLabel(currentGroup)}}</a></li>',l+='<li ng-if="settings.selectByGroups && settings.showEnableSearchButton" class="divider"></li>',l+='<li ng-if="settings.showEnableSearchButton && settings.enableSearch"><a ng-keydown="keyDownLink($event); keyDownToggleSearch();" ng-click="toggleSearch($event);" tabindex="-1">{{texts.disableSearch}}</a></li>',l+='<li ng-if="settings.showEnableSearchButton && !settings.enableSearch"><a ng-keydown="keyDownLink($event); keyDownToggleSearch();" ng-click="toggleSearch($event);" tabindex="-1">{{texts.enableSearch}}</a></li>',l+='<li ng-if="(settings.showCheckAll && settings.selectionLimit > 0) || settings.showUncheckAll || settings.showEnableSearchButton" class="divider"></li>',l+='<li ng-if="settings.enableSearch"><div class="dropdown-header"><input type="text" class="form-control searchField" ng-keydown="keyDownSearchDefault($event); keyDownSearch($event, input.searchFilter);" ng-style="{width: \'100%\'}" ng-model="input.searchFilter" placeholder="{{texts.searchPlaceholder}}" /></li>',l+='<li ng-if="settings.enableSearch" class="divider"></li>',!!t.groupBy?(l+='<li ng-repeat-start="option in orderedItems | filter:getFilter(input.searchFilter)" ng-show="getPropertyForObject(option, settings.groupBy) !== getPropertyForObject(orderedItems[$index - 1], settings.groupBy)" role="presentation" class="dropdown-header">{{ getGroupLabel(getPropertyForObject(option, settings.groupBy)) }}</li>',l+='<li ng-class="{\'active\': isChecked(getPropertyForObject(option,settings.idProp)) && settings.styleActive}" ng-repeat-end role="presentation">'):l+='<li ng-class="{\'active\': isChecked(getPropertyForObject(option,settings.idProp)) && settings.styleActive}" role="presentation" ng-repeat="option in options | filter:getFilter(input.searchFilter)">',l+='<a ng-keydown="option.disabled || keyDownLink($event)" role="menuitem" class="option" tabindex="-1" ng-click="option.disabled || setSelectedItem(getPropertyForObject(option,settings.idProp), false, true)" ng-disabled="option.disabled">',l+=n?'<div class="checkbox"><label><input class="checkboxInput" type="checkbox" ng-click="checkboxClick($event, getPropertyForObject(option,settings.idProp))" ng-checked="isChecked(getPropertyForObject(option,settings.idProp))" /> <span mf-dropdown-static-include="{{settings.template}}"></div></label></span></a>':'<span data-ng-class="{\'glyphicon glyphicon-ok\': isChecked(getPropertyForObject(option,settings.idProp))}"> </span> <span mf-dropdown-static-include="{{settings.template}}"></span></a>',l+="</li>",l+='<li class="divider" ng-show="settings.selectionLimit > 1"></li>',l+='<li role="presentation" ng-show="settings.selectionLimit > 1"><a role="menuitem">{{selectedModel.length}} {{texts.selectionOf}} {{settings.selectionLimit}} {{texts.selectionCount}}</a></li>',l+="</ul>",l+="</div>",e.html(l)},link:function(i,l,e){var o=l.children()[0];function r(e){var t={};return""===i.settings.externalIdProp?t[i.settings.idProp]=e:t[i.settings.externalIdProp]=e,t}function c(e){for(var t in e)delete e[t]}i.toggleDropdown=function(){i.open?i.close():i.open=!0,i.settings.keyboardControls&&i.open&&(1===i.settings.selectionLimit&&i.settings.enableSearch?setTimeout(function(){angular.element(l)[0].querySelector(".searchField").focus()},0):setTimeout(function(){angular.element(l)[0].querySelector(".option").focus()},0))},i.checkboxClick=function(e,t){i.setSelectedItem(t,!1,!0),e.stopImmediatePropagation()},i.externalEvents={onItemSelect:angular.noop,onItemDeselect:angular.noop,onSelectAll:angular.noop,onDeselectAll:angular.noop,onInitDone:angular.noop,onMaxSelectionReached:angular.noop,onSelectionChanged:angular.noop,onClose:angular.noop},i.settings={dynamicTitle:!0,scrollable:!1,scrollableHeight:"300px",closeOnBlur:!0,displayProp:"label",idProp:"id",externalIdProp:"id",enableSearch:!1,selectionLimit:0,showCheckAll:!0,showUncheckAll:!0,showEnableSearchButton:!1,closeOnSelect:!1,buttonClasses:"btn btn-default",closeOnDeselect:!1,groupBy:e.groupBy||void 0,groupByTextProvider:null,smartButtonMaxItems:0,smartButtonTextConverter:angular.noop,styleActive:!1,keyboardControls:!1,template:"{{getPropertyForObject(option, settings.displayProp)}}",searchField:"$"},i.texts={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"checked",selectionOf:"/",searchPlaceholder:"Search...",buttonDefaultText:"Select",dynamicButtonTextSuffix:"checked",disableSearch:"Disable search",enableSearch:"Enable search",selectGroup:"Select all:"},i.input={searchFilter:i.searchFilter||""},angular.isDefined(i.settings.groupBy)&&i.$watch("options",function(e){angular.isDefined(e)&&(i.orderedItems=s("orderBy")(e,i.settings.groupBy))}),i.$watch("selectedModel",function(e){Array.isArray(e)?i.singleSelection=!1:i.singleSelection=!0}),i.close=function(){i.open=!1,i.externalEvents.onClose()},i.selectCurrentGroup=function(t){i.selectedModel.splice(0,i.selectedModel.length),i.orderedItems&&i.orderedItems.forEach(function(e){e[i.groupBy]===t&&i.setSelectedItem(i.getPropertyForObject(e,i.settings.idProp),!1,!1)}),i.externalEvents.onSelectionChanged()},angular.extend(i.settings,i.extraSettings||[]),angular.extend(i.externalEvents,i.events||[]),angular.extend(i.texts,i.translationTexts),i.singleSelection=1===i.settings.selectionLimit,i.singleSelection&&angular.isArray(i.selectedModel)&&0===i.selectedModel.length&&c(i.selectedModel),i.settings.closeOnBlur&&t.on("click",function(e){if(i.open){for(var t=e.target.parentElement,n=!1;angular.isDefined(t)&&null!==t&&!n;)t.className.split&&contains(t.className.split(" "),"multiselect-parent")&&!n&&t===o&&(n=!0),t=t.parentElement;n||i.$apply(function(){i.close()})}}),i.getGroupLabel=function(e){return null!==i.settings.groupByTextProvider?i.settings.groupByTextProvider(e):e},i.getButtonText=function(){if(i.settings.dynamicTitle&&(0<i.selectedModel.length||angular.isObject(i.selectedModel)&&0<Object.keys(i.selectedModel).length)){if(0<i.settings.smartButtonMaxItems){var l=[];return angular.forEach(i.options,function(e){if(i.isChecked(i.getPropertyForObject(e,i.settings.idProp))){var t=i.getPropertyForObject(e,i.settings.displayProp),n=i.settings.smartButtonTextConverter(t,e);l.push(n||t)}}),i.selectedModel.length>i.settings.smartButtonMaxItems&&(l=l.slice(0,i.settings.smartButtonMaxItems)).push("..."),l.join(", ")}var e;return 0===(e=i.singleSelection?null!==i.selectedModel&&angular.isDefined(i.selectedModel[i.settings.idProp])?1:0:angular.isDefined(i.selectedModel)?i.selectedModel.length:0)?i.texts.buttonDefaultText:e+" "+i.texts.dynamicButtonTextSuffix}return i.texts.buttonDefaultText},i.getPropertyForObject=function(e,t){if(angular.isDefined(e)&&e.hasOwnProperty(t))return e[t]},i.selectAll=function(){var e;i.deselectAll(!0),i.externalEvents.onSelectAll(),e=s("filter")(i.options,i.getFilter(i.input.searchFilter)),angular.forEach(e,function(e){i.setSelectedItem(e[i.settings.idProp],!0,!1)}),i.externalEvents.onSelectionChanged(),i.selectedGroup=null},i.deselectAll=function(e){(e=e||!1)||i.externalEvents.onDeselectAll(),i.singleSelection?c(i.selectedModel):i.selectedModel.splice(0,i.selectedModel.length),e||i.externalEvents.onSelectionChanged(),i.selectedGroup=null},i.setSelectedItem=function(e,t,n){var l=r(e),o=null;if(o=""===i.settings.externalIdProp?find(i.options,l):l,i.singleSelection)c(i.selectedModel),angular.extend(i.selectedModel,o),n&&i.externalEvents.onItemSelect(o),(i.settings.closeOnSelect||i.settings.closeOnDeselect)&&i.close();else{t=t||!1;var s=-1!==findIndex(i.selectedModel,l);!t&&s?(i.selectedModel.splice(findIndex(i.selectedModel,l),1),i.externalEvents.onItemDeselect(l),i.settings.closeOnDeselect&&i.close()):!s&&(0===i.settings.selectionLimit||i.selectedModel.length<i.settings.selectionLimit)&&(i.selectedModel.push(o),n&&i.externalEvents.onItemSelect(o),i.settings.closeOnSelect&&i.close(),0<i.settings.selectionLimit&&i.selectedModel.length===i.settings.selectionLimit&&i.externalEvents.onMaxSelectionReached())}n&&i.externalEvents.onSelectionChanged(),i.selectedGroup=null},i.isChecked=function(e){return i.singleSelection?null!==i.selectedModel&&angular.isDefined(i.selectedModel[i.settings.externalIdProp])&&i.selectedModel[i.settings.externalIdProp]===r(e)[i.settings.externalIdProp]:-1!==findIndex(i.selectedModel,r(e))},i.externalEvents.onInitDone(),i.keyDownLink=function(e){var t,n=angular.element(e.target).scope(),l=e.target.parentNode;if(i.settings.keyboardControls)if(13===e.keyCode||32===e.keyCode)e.preventDefault(),n.option?i.setSelectedItem(i.getPropertyForObject(n.option,i.settings.idProp),!1,!0):"deselectAll"===e.target.id?i.deselectAll():"selectAll"===e.target.id&&i.selectAll();else if(38===e.keyCode){for(e.preventDefault(),l.previousElementSibling&&(t=l.previousElementSibling.querySelector("a")||l.previousElementSibling.querySelector("input"));!t&&l;)(l=l.previousElementSibling)&&(t=l.querySelector("a")||l.querySelector("input"));t&&t.focus()}else if(40===e.keyCode){for(e.preventDefault(),l.nextElementSibling&&(t=l.nextElementSibling.querySelector("a")||l.nextElementSibling.querySelector("input"));!t&&l;)(l=l.nextElementSibling)&&(t=l.querySelector("a")||l.querySelector("input"));t&&t.focus()}else 27===e.keyCode&&(e.preventDefault(),i.toggleDropdown())},i.keyDownSearchDefault=function(e){var t,n=e.target.parentNode.parentNode;if(i.settings.keyboardControls)if(9===e.keyCode||40===e.keyCode)e.preventDefault(),setTimeout(function(){angular.element(l)[0].querySelector(".option").focus()},0);else if(38===e.keyCode){for(e.preventDefault(),n.previousElementSibling&&(t=n.previousElementSibling.querySelector("a")||n.previousElementSibling.querySelector("input"));!t&&n;)(n=n.previousElementSibling)&&(t=n.querySelector("a")||n.querySelector("input"));t&&t.focus()}else 27===e.keyCode&&(e.preventDefault(),i.toggleDropdown())},i.keyDownSearch=function(e,t){var n;i.settings.keyboardControls&&13===e.keyCode&&(1===i.settings.selectionLimit&&i.settings.enableSearch?1===(n=s("filter")(i.options,i.getFilter(t))).length&&i.setSelectedItem(i.getPropertyForObject(n[0],i.settings.idProp),!1,!0):i.settings.enableSearch&&i.selectAll())},i.getFilter=function(e){var t={};return t[i.settings.searchField]=e,t},i.toggleSearch=function(e){e&&e.stopPropagation(),i.settings.enableSearch=!i.settings.enableSearch,i.settings.enableSearch||(i.input.searchFilter="")},i.keyDownToggleSearch=function(){i.settings.keyboardControls&&13===event.keyCode&&(i.toggleSearch(),i.settings.enableSearch?setTimeout(function(){angular.element(l)[0].querySelector(".searchField").focus()},0):angular.element(l)[0].querySelector(".option").focus())}}}}]);
